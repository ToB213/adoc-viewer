= AITAmbulanceTeamDetector

救急隊が搬送対象とする市民を決定するためのモジュールです．
このモジュールは，市民の生存時間，他の救急隊との距離，埋没状態などを考慮して，適した搬送対象の市民を決定します．
また，他の救急隊との競合を避けるように設計されています．

== フィールド

搬送対象の市民ID::
この救急隊が搬送する市民のIDです．

搬送対象候補の市民情報::
搬送対象となりうる市民のIDと、その市民が現在搬送対象かどうかを表すフラグを保持します

他の救急隊の情報::
知覚した他の救急隊のIDを保持します．

エージェントの移動速度::
エージェントの移動速度の平均値を保持します．

== サブモジュール

特に定義されたサブモジュールはないです．

== getTarget()

この救急隊の搬送対象のIDを返します．

== updateInfo(MessageManager)

エージェントの内部情報更新のためのメソッドです．
メッセージの送受信，搬送対象候補の市民情報の更新をおこないます．

搬送候補となる市民の情報を更新::
知覚した市民の情報を搬送候補となるかどうかを判断し，搬送対象となる市民のみ，
搬送候補となる市民の保持します．

== calc()

搬送対象の市民を決定し， 搬送対象の市民IDにそのIDをセットします．

=== 1.自身が市民を搬送中かどうかを確認
- 搬送中の場合：
. 搬送対象の市民IDに搬送中の市民のIDをセットします．
. 処理を終了


=== 2.搬送対象候補の市民情報が空かどうかを確認します．
- 空の場合：
. 搬送対象の市民IDに `null` をセットします．
. 処理を終了

=== 3.知覚した他の救急隊の情報を更新します．

=== 4. 搬送対象候補の市民情報から，適した市民を選択し，搬送対象の市民IDにセットします．

== 知覚した他の救急隊の情報を取得

そのステップに知覚した救急隊の情報を取得します．

== 搬送候補となる市民の情報を更新

知覚した市民から搬送対象となるかどうかを判断し，搬送対象となる市民の情報を `targetCivilianIDs` に保持します．

=== 知覚したエンティティを走査し，市民の場合（`CIVILIAN`）の場合のみ以下の処理をおこないます
. 今まで搬送対象としている市民がいる場合：
    .. 一定時間内に再度知覚されない場合は，他の救急隊が救助したか，歩ける状態になったと判断し，搬送候補から除外します．
. まだ情報にない市民であれば，搬送対象外として情報を追加します．
. 市民が建物内にいて，避難所と救急隊の中にいない場合：
    .. 避難所までの距離と生存時間を計算し，搬送可能かどうかを判定します．
    .. 埋没しておらず，ダメージを受けている場合は搬送対象（`true`）と設定します．
. 搬送対象（`true`）の市民が建物内にいるかどうかを確認し，そうでない場合は搬送対象外（`false`）とします．


== 搬送対象の市民の選択

搬送対象となる市民候補から，適した市民を選択します．
他の救急隊の方が搬送に適している場合は，候補から除外します．

=== 1.搬送対象候補の市民情報の中から，以下の条件を満たす市民を探す．
* 搬送対象である．
* 自分よりも他の救急隊の方が市民に近い場合は，候補から除外します．

=== 2.上記の条件を満たす市民の中で，最も距離が近い市民を選択します．
* 同じ距離の場合は，他の救急隊と比較してEntityID（救急隊の識別子）が低い方を選択します．
=== 3.選択された市民のIDを返します．

== その他
- このモジュールは，市民の生存時間，他の救急隊との距離，埋没状態などを考慮して，適した搬送対象の市民を決定します．
- 搬送対象候補の市民情報は，シミュレーションの環境の変化に応じて動的に更新されます．
- 他の救急隊との競合を避けるように設計されています．